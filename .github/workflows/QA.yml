name: Sedstart Prod

on:
  workflow_dispatch:

jobs:
  sedstart-run:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger SedStart test run
        uses: sedinqa/sedstart@v1
        with:
          api_key: ${{ secrets.SEDSTART_API_KEY_PROD }}
          project_id: 334
          test_id: 2077
          profile_id: 406
          browser: chrome
          headless: false

      # ✅ Microsoft Teams notification on SUCCESS
      - name: Teams Notify - Success
        if: success()
        run: |
          curl -H "Content-Type: application/json" -d '{
            "@type": "MessageCard",
            "@context": "http://schema.org/extensions",
            "summary": "Sedstart Tests Passed",
            "title": "✅ Sedstart PROD Tests PASSED",
            "sections": [{
              "facts": [
                { "name": "Repository", "value": "${{ github.repository }}" },
                { "name": "Workflow", "value": "Sedstart Prod" }
              ]
            }]
          }' ${{ secrets.TEAMS_WEBHOOK_URL }}

      # ❌ Microsoft Teams notification on FAILURE
      - name: Teams Notify - Failure
        if: failure()
        run: |
          curl -H "Content-Type: application/json" -d '{
            "@type": "MessageCard",
            "@context": "http://schema.org/extensions",
            "summary": "Sedstart Tests Failed",
            "title": "❌ Sedstart PROD Tests FAILED",
            "sections": [{
              "facts": [
                { "name": "Repository", "value": "${{ github.repository }}" },
                { "name": "Logs", "value": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" }
              ]
            }]
          }' ${{ secrets.TEAMS_WEBHOOK_URL }}
